<!-- sections/video.liquid -->
{% comment %}
  Video section — supports autoplay or click-to-play
{% endcomment %}

<div
  class="ss-section-inner {{ section.settings.color_scheme }} {{ section.settings.color_border }} {{ section.settings.style_border }}"
  style="
    padding-top: {{ section.settings.spacing_top }}px;
    padding-bottom: {{ section.settings.spacing_bottom }}px;
  "
>
  <div id="video-{{ section.settings.vid }}" class="video-section">
    <div class="{{ settings.layout_horizontal }} w-full">
      <div class="container mx-auto px-2 md:px-6">
        {% if section.settings.heading %}
          <h2 class="text-3xl md:text-5xl mb-6">{{ section.settings.heading }}</h2>
        {% endif %}

        <div class="flex flex-col lg:flex-row items-center gap-8">
          <!-- LEFT SIDE — TEXT -->
          <div class="w-full lg:w-1/2 prose max-w-none">
            {{ section.settings.content }}
          </div>

          <!-- RIGHT SIDE — VIDEO -->
          <div
            class="relative w-full lg:w-1/2"
            x-data="
              videoPlayer({
                autoplay: {{ section.settings.auto_play | json }}
              })
            "
            x-init="init()"
          >
            <div class="relative flex justify-center {{ section.settings.aspect_ratio }}">
              <video
                class="rounded-lg object-cover w-full h-full drop-shadow-xl"
                x-ref="video"
                playsinline
                poster="
                  {% if section.settings.image_background == blank %}
                    https://cdn.shopify.com/s/files/1/0533/2089/files/placeholder-images-image_large.png?format=webp&v=1530129081
                  {% else %}
                    {{ section.settings.image_background | image_url: width: 1200 }}
                  {% endif %}
                "
              >
                {% for source in section.settings.video_background.sources %}
                  <source src="{{ source.url }}" type="{{ source.mime_type }}">
                {% endfor %}
              </video>
            </div>

            <!-- PLAY BUTTON -->
            <button
              x-ref="playBtn"
              class="absolute inset-0 z-10 flex items-center justify-center transition-opacity duration-300"
              @click="playVideo"
            >
              <span class="{{ section.settings.color_button }} cursor-pointer flex items-center gap-2">
                {% render 'component__icon', icon: 'play', size: '20', class: 'mr-2' %}
                {{ 'general.media.play' | t }}
              </span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  window.videoPlayer = function ({ autoplay = false }) {
    return {
      autoplay,
      init() {
        const video = this.$refs.video;
        const btn = this.$refs.playBtn;

        if (!this.autoplay) return;

        video.muted = true;
        video.controls = false;

        const attempt = video.play();
        if (attempt !== undefined) {
          attempt.then(() => (btn.style.display = 'none')).catch(() => (btn.style.display = 'flex'));
        }
      },
      playVideo() {
        const video = this.$refs.video;
        const btn = this.$refs.playBtn;

        video.controls = true;
        video.muted = false;
        video.play();

        btn.style.opacity = 0;
        setTimeout(() => (btn.style.display = 'none'), 250);
      },
    };
  };
</script>

{% schema %}
{
  "name": "t:sections.video.name",
  "settings": [
    {
      "type": "text",
      "id": "vid",
      "label": "Section ID"
    },
    {
      "type": "header",
      "content": "t:sections.all.headers.header__4.content"
    },
    {
      "type": "image_picker",
      "id": "image_background",
      "label": "t:sections.video.settings.image_background.label",
      "info": "t:sections.video.settings.image_background.info"
    },
    {
      "type": "video",
      "id": "video_background",
      "label": "t:sections.video.settings.video_background.label"
    },
    {
      "type": "checkbox",
      "id": "auto_play",
      "label": "t:sections.video.settings.auto_play.label",
      "info": "t:sections.video.settings.auto_play.info",
      "default": true
    },
    {
      "type": "text",
      "id": "heading",
      "label": "t:sections.all.content.settings.heading.label"
    },
    {
      "type": "richtext",
      "id": "content",
      "label": "t:sections.all.content.settings.content.label"
    },
    {
      "type": "text",
      "id": "button_label",
      "label": "t:sections.all.content.settings.button_label.label"
    },
    {
      "type": "url",
      "id": "button_url",
      "label": "t:sections.all.content.settings.button_url.label"
    },
    {
      "type": "header",
      "content": "t:sections.all.headers.header__22.content"
    },
    {
      "type": "range",
      "id": "spacing_top",
      "min": 0,
      "max": 300,
      "step": 20,
      "unit": "px",
      "label": "t:sections.all.layout.settings.spacing.label_top",
      "default": 100
    },
    {
      "type": "range",
      "id": "spacing_bottom",
      "min": 0,
      "max": 300,
      "step": 20,
      "unit": "px",
      "label": "t:sections.all.layout.settings.spacing.label_bottom",
      "default": 100
    },
    {
      "type": "header",
      "content": "t:sections.all.headers.header__1.content"
    },
    {
      "type": "select",
      "id": "color_scheme",
      "label": "t:sections.all.colors.settings.color_scheme.label",
      "options": [
        {
          "value": "color__bg-body color__text",
          "label": "t:sections.all.colors.settings.color_scheme.options__1.label"
        },
        {
          "value": "color__bg-neutral color__text",
          "label": "t:sections.all.colors.settings.color_scheme.options__2.label"
        },
        {
          "value": "color__bg-overlay-1 color__text",
          "label": "t:sections.all.colors.settings.color_scheme.options__3.label"
        },
        {
          "value": "color__bg-overlay-2 color__text",
          "label": "t:sections.all.colors.settings.color_scheme.options__4.label"
        },
        {
          "value": "color__bg-overlay-3 color__text",
          "label": "t:sections.all.colors.settings.color_scheme.options__5.label"
        },
        {
          "value": "color__bg-primary color__primary",
          "label": "t:sections.all.colors.settings.color_scheme.options__6.label"
        },
        {
          "value": "color__bg-secondary color__secondary",
          "label": "t:sections.all.colors.settings.color_scheme.options__7.label"
        },
        {
          "value": "color__bg-tertiary color__tertiary",
          "label": "t:sections.all.colors.settings.color_scheme.options__8.label"
        }
      ],
      "default": "color__bg-body color__text"
    },
    {
      "type": "select",
      "id": "color_border",
      "label": "t:sections.all.colors.settings.color_border.label",
      "options": [
        {
          "value": "color__border-divider-1",
          "label": "t:sections.all.colors.settings.color_border.options__1.label"
        },
        {
          "value": "color__border-selected-1",
          "label": "t:sections.all.colors.settings.color_border.options__2.label"
        }
      ],
      "default": "color__border-divider-1"
    },
    {
      "type": "select",
      "id": "color_button",
      "label": "t:sections.all.colors.settings.color_button.label",
      "options": [
        {
          "value": "btn",
          "label": "t:sections.all.colors.settings.color_button.options__1.label"
        },
        {
          "value": "btn btn--secondary",
          "label": "t:sections.all.colors.settings.color_button.options__2.label"
        },
        {
          "value": "btn btn--tertiary",
          "label": "t:sections.all.colors.settings.color_button.options__5.label"
        },
        {
          "value": "btn btn--neutral",
          "label": "t:sections.all.colors.settings.color_button.options__3.label"
        },
        {
          "value": "btn btn--plain",
          "label": "t:sections.all.colors.settings.color_button.options__4.label"
        }
      ],
      "default": "btn btn--secondary"
    },
    {
      "type": "header",
      "content": "t:sections.all.headers.header__2.content"
    },
    {
      "type": "select",
      "id": "style_border",
      "label": "t:sections.all.styles.settings.style_border.label",
      "options": [
        {
          "value": "",
          "label": "t:sections.all.styles.settings.style_border.options__1.label"
        },
        {
          "value": "border--t-width",
          "label": "t:sections.all.styles.settings.style_border.options__2.label"
        },
        {
          "value": "border--b-width",
          "label": "t:sections.all.styles.settings.style_border.options__3.label"
        },
        {
          "value": "border--b-width border--t-width",
          "label": "t:sections.all.styles.settings.style_border.options__4.label"
        }
      ],
      "default": "border--b-width"
    },
    {
      "type": "header",
      "content": "t:sections.all.headers.header__3.content"
    },
    {
      "type": "select",
      "id": "layout_x_alignment",
      "label": "t:sections.all.layout.settings.layout_x_alignment.label",
      "options": [
        {
          "value": "justify-between",
          "label": "t:sections.all.layout.settings.layout_x_alignment.options__1.label"
        },
        {
          "value": "text-center justify-center flex-col items-center",
          "label": "t:sections.all.layout.settings.layout_x_alignment.options__2.label"
        },
        {
          "value": "text-right justify-end flex-col items-end",
          "label": "t:sections.all.layout.settings.layout_x_alignment.options__3.label"
        }
      ],
      "default": "justify-between"
    },
    {
      "type": "header",
      "content": "t:sections.all.headers.header__8.content"
    },
    {
      "type": "select",
      "id": "aspect_ratio",
      "label": "t:sections.video.settings.aspect_ratio.label",
      "options": [
        {
          "value": "aspect-[2/3]",
          "label": "t:sections.video.settings.aspect_ratio.options__2.label"
        },
        {
          "value": "aspect-[1/1]",
          "label": "t:sections.video.settings.aspect_ratio.options__3.label"
        },
        {
          "value": "aspect-video",
          "label": "t:sections.video.settings.aspect_ratio.options__1.label"
        }
      ],
      "default": "aspect-video"
    },
    {
      "type": "select",
      "id": "visibility",
      "label": "t:sections.all.visibility.label",
      "options": [
        {
          "value": "",
          "label": "t:sections.all.visibility.options__1.label"
        },
        {
          "value": "md:hidden",
          "label": "t:sections.all.visibility.options__2.label"
        },
        {
          "value": "hidden md:block",
          "label": "t:sections.all.visibility.options__3.label"
        }
      ],
      "default": ""
    }
  ],
  "presets": [
    {
      "name": "t:sections.video.name",
      "settings": {
        "color_scheme": "color__bg-body color__text",
        "color_border": "color__border-divider-1",
        "color_button": "btn btn--secondary",
        "style_border": "border--b-width",
        "heading": "Video",
        "content": "<p>Give customers a summary of the video you want to share.</p>",
        "button_label": "Button",
        "button_url": "/"
      }
    }
  ],
  "disabled_on": {
    "groups": ["custom.overlay"]
  }
}
{% endschema %}
