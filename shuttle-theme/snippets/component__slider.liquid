<!-- snippets/component__slider.liquid -->
<div class="flex flex-wrap {{ outer_class }}">
  <div
    class="relative w-full"
    x-data="{
      index: 0,
      index_size: {{ slider_size }},
      show_arrows: false,

      slides() {
        return this.$refs.slider.querySelectorAll('[data-slide]');
      },

      updateOverflow() {
        this.$nextTick(() => {
          const el = this.$refs.slider;
          this.show_arrows = el.scrollWidth > el.clientWidth + 20;
        });
      },

      scrollToIndex(i) {
        const slider = this.$refs.slider;
        const slide = this.slides()[i];
        if (!slide) return;

        const maxScroll =
          slider.scrollWidth - slider.clientWidth;

        const target = Math.min(slide.offsetLeft, maxScroll);

        slider.scrollTo({
          left: target,
          behavior: 'smooth'
        });

        this.index = i;
      },


      scrollNext() {
        this.scrollToIndex(this.index < this.index_size ? this.index + 1 : 0);
      },

      scrollBack() {
        this.scrollToIndex(this.index > 0 ? this.index - 1 : this.index_size);
      },

      syncIndex() {
        const slider = this.$refs.slider;
        let closest = 0;
        let dist = Infinity;

        this.slides().forEach((slide, i) => {
          const d = Math.abs(slide.offsetLeft - slider.scrollLeft);
          if (d < dist) {
            dist = d;
            closest = i;
          }
        });

        this.index = closest;
      }
    }"
    x-init="
      updateOverflow();
      window.addEventListener('resize', () => updateOverflow());
      $refs.slider.addEventListener('scroll', () => syncIndex());
    "
  >

    <!-- Slides -->
   <div
  class="hidescrollbar slider-scroll slider-momentum inline-flex w-full overflow-x-auto overflow-y-hidden scroll-smooth snap-x snap-proximity gap-10 pl-3 pr-6"
  x-ref="slider"> 
    {{ slides }}
  </div>

    <!-- Arrows (desktop) -->
      <div
        class="hidden md:flex justify-end gap-3 pt-4 slider-arrows {{ settings.layout_horizontal }}"
        x-show="show_arrows"
        x-cloak
      >
        <button
          @click="scrollBack()"
          aria-label="Previous slide"
          class="
            inline-flex items-center justify-center
            w-11 h-11
            rounded-full
            border-2 border-white
            text-white
            bg-transparent
            transition
            hover:bg-white/10
            hover:-translate-y-0.5
            focus:outline-none
            focus:ring-2 focus:ring-white/60 focus:ring-offset-2 focus:ring-offset-transparent
          "
        >
          {% render 'component__icon', icon: 'arrow-left', size: '20', class: 'fill-white' %}
        </button>

        <button
          @click="scrollNext()"
          aria-label="Next slide"
          class="
            inline-flex items-center justify-center
            w-11 h-11
            rounded-full
            border-2 border-white
            text-white
            bg-transparent
            transition
            hover:bg-white/10
            hover:-translate-y-0.5
            focus:outline-none
            focus:ring-2 focus:ring-white/60 focus:ring-offset-2 focus:ring-offset-transparent
          "
        >
          {% render 'component__icon', icon: 'arrow-right', size: '20', class: 'fill-white' %}
        </button>
      </div>



    <!-- Pagination dots -->
    <div class="slider-dots md:hidden">
      <template x-for="i in (index_size + 1)" :key="i">
        <button
          class="slider-dot"
          :class="{ 'is-active': index === (i - 1) }"
          @click="scrollToIndex(i - 1)"
          aria-label="Go to slide"
        ></button>
      </template>
    </div>

  </div>
</div>
